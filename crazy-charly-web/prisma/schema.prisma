generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Article {
  id          String        @id @default(uuid())
  designation String
  categorie   Categorie
  trancheAge  TrancheAge
  etat        Etat
  prix        Int
  poids       Int
  statut      StatutArticle @default(DISPONIBLE)
  boxId       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  box         Box?          @relation(fields: [boxId], references: [id])

  @@map("articles")
}

model Utilisateur {
  id                    String   @id @default(uuid())
  authProviderId        String   @unique @map("auth_provider_id")
  email                 String   @unique
  nom                   String?
  prenom                String?
  role                  Role     @default(abonne)
  trancheAgeEnfant      String?  @map("tranche_age_enfant")
  preferencesCategories String?  @map("preferences_categories")
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  boxes                 Box[]

  @@map("utilisateur")
}

model Campagne {
  id         String         @id @default(uuid())
  nom        String
  poidsMax   Int
  statut     StatutCampagne @default(BROUILLON)
  totalScore Int?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  boxes      Box[]

  @@map("campagnes")
}

model Box {
  id            String      @id @default(uuid())
  score         Int
  poidsTotal    Int
  prixTotal     Int
  campagneId    String
  utilisateurId String
  createdAt     DateTime    @default(now())
  articles      Article[]
  campagne      Campagne    @relation(fields: [campagneId], references: [id], onDelete: Cascade)
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@map("boxes")
}

enum Categorie {
  SOC
  FIG
  CON
  EXT
  EVL
  LIV
}

enum TrancheAge {
  BB
  PE
  EN
  AD
}

enum Etat {
  N
  TB
  B
}

enum StatutArticle {
  DISPONIBLE
  EN_ATTENTE
  VALIDE
}

enum StatutCampagne {
  BROUILLON
  COMPOSEE
  VALIDEE
}

enum Role {
  abonne
  admin
}
